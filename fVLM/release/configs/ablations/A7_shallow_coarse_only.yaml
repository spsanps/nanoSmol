# =============================================================================
# Ablation A7: Shallow Query + Coarse-Only (Interaction Control)
# =============================================================================
# Completes the 2x2 factorial design:
#
#   |              | Coarse+Fine | Coarse-Only |
#   |--------------|-------------|-------------|
#   | Deep query   | baseline    | A6          |
#   | Shallow query| A1          | A7 (this)   |
#
# If the interaction (deep × fine) is significant, the effect of going
# coarse→fine should be LARGER for deep query than for shallow query.
# i.e. (baseline - A6) >> (A1 - A7)
#
# This is the "double ablation" that validates the core mechanism.
# =============================================================================

stage: 1

model:
  llm: /workspace/models/SmolLM2-135M-Instruct
  dino: /workspace/models/dinov2-small
  deep_query: false              # <-- shallow query (like A1)
  query_dim: 384
  visual_scale: 0.14
  lambda_coarse: 0.0
  coarse_only: true              # <-- coarse-only (like A6)
  gradient_checkpointing: false

data:
  train_shards: "/workspace/data/openvid/*.tar"
  val_shards: "/workspace/data/eval/val_10k/*.tar"
  text_shards: "/workspace/data/text_retention/stage1/*.tar"
  text_ratio: 0.14
  max_frames: 64
  frame_size: 224
  num_workers: 8

training:
  total_samples: 300_000
  batch_size: 8
  grad_accum: 4
  lr_connector: 1.0e-4
  lr_dino: 1.0e-5
  lr_llm: 1.0e-5
  warmup_ratio: 0.05
  weight_decay: 0.01
  max_grad_norm: 1.0
  schedule: cosine
  dtype: bfloat16
  compile: false
  seed: 42

loss:
  type: text_ce_all

checkpoint:
  save_dir: /workspace/checkpoints/ablations/A7_shallow_coarse_only
  save_every_steps: 1000
  keep_last: 2
  keep_best: 1
  metric: val_loss
  resume: auto

eval:
  every_steps: 200
  max_samples: 1000

wandb:
  project: foveated-vlm-ablations
  run_name: A7_shallow_coarse_only
